digraph WMF {
  splines=true;
  sep = 1;
  node [shape=box];
  subgraph web_traffic {
    the_internet -> ssl_terminators;
    the_internet -> frontend_varnish [style=dashed];
    ssl_terminators -> frontend_varnish;
    frontend_varnish -> backend_varnish [style=tapered, penwidth=10, arrowhead=none];
    backend_varnish -> {web:apache, api:hhvm};
    {web:hhvm, api:hhvm} -> {mysql, redis, elasticsearch, swift};
    elasticsearch -> elasticsearch [style=tapered, penwidth=10, arrowhead=none];
  }
  subgraph jobs {
    // These arrows are reversed so dot will throw these nodes under the web_traffic ones
    edge [color="#8800cc", dir="back"]
    {mysql, redis, elasticsearch} -> jobrunner;
    {mysql, swift} -> imagescaler;
  }

  the_internet [shape=tripleoctagon];
  web [shape=record, label="{<apache>apache | <hhvm>hhvm}"]
  api [shape=record, label="{<apache>apache | <hhvm>hhvm}"]
}
